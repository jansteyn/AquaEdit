<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:AquaEdit.UI.Avalonia.ViewModels"
        mc:Ignorable="d" d:DesignWidth="700" d:DesignHeight="500"
        x:Class="AquaEdit.UI.Avalonia.Views.Dialogs.PluginManagerDialog"
        x:DataType="vm:PluginManagerViewModel"
        Title="Plugin Manager"
        Width="700" Height="500"
        MinWidth="600" MinHeight="400"
        WindowStartupLocation="CenterOwner">

  <Design.DataContext>
    <vm:PluginManagerViewModel />
  </Design.DataContext>

  <DockPanel>
    <!-- Toolbar -->
    <Border DockPanel.Dock="Top"
            BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
            BorderThickness="0,0,0,1"
            Padding="8">
      <Grid ColumnDefinitions="*,Auto">
        <!-- Search Box -->
        <TextBox Grid.Column="0"
                 Text="{Binding SearchText}"
                 Watermark="Search plugins..."
                 Margin="0,0,8,0">
          <TextBox.InnerLeftContent>
            <PathIcon Data="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"
                      Width="16" Height="16"
                      Margin="8,0,0,0" />
          </TextBox.InnerLeftContent>
        </TextBox>

        <!-- Action Buttons -->
        <StackPanel Grid.Column="1" 
                    Orientation="Horizontal" 
                    Spacing="4">
          <Button Command="{Binding RefreshCommand}"
                  ToolTip.Tip="Refresh">
            <PathIcon Data="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z"
                      Width="16" Height="16" />
          </Button>
          <Button Command="{Binding InstallPluginCommand}"
                  Content="Install Plugin" />
        </StackPanel>
      </Grid>
    </Border>

    <!-- Button Bar -->
    <Border DockPanel.Dock="Bottom"
            Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
            BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
            BorderThickness="0,1,0,0"
            Padding="16">
      <Button Content="Close"
              Command="{Binding CloseCommand}"
              HorizontalAlignment="Right"
              MinWidth="100" />
    </Border>

    <!-- Plugin List and Details -->
    <Grid ColumnDefinitions="300,*">
      <!-- Plugin List -->
      <Border Grid.Column="0"
              BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
              BorderThickness="0,0,1,0">
        <ListBox ItemsSource="{Binding FilteredPlugins}"
                 SelectedItem="{Binding SelectedPlugin}">
          <ListBox.ItemTemplate>
            <DataTemplate>
              <Grid ColumnDefinitions="*,Auto" Margin="8">
                <StackPanel Grid.Column="0" Spacing="4">
                  <TextBlock Text="{Binding Name}"
                             FontWeight="SemiBold" />
                  <TextBlock Text="{Binding Version}"
                             FontSize="11"
                             Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                </StackPanel>
                <Border Grid.Column="1"
                        Background="{Binding IsEnabled, Converter={StaticResource BoolToColorConverter}}"
                        CornerRadius="3"
                        Padding="6,2">
                  <TextBlock Text="{Binding StatusText}"
                             FontSize="10"
                             Foreground="White" />
                </Border>
              </Grid>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>
      </Border>

      <!-- Plugin Details -->
      <ScrollViewer Grid.Column="1">
        <StackPanel Margin="16" 
                    Spacing="16"
                    IsVisible="{Binding SelectedPlugin, Converter={x:Static ObjectConverters.IsNotNull}}">
          
          <!-- Header -->
          <StackPanel Spacing="8">
            <TextBlock Text="{Binding SelectedPlugin.Name, TargetNullValue=''}"
                       FontSize="24"
                       FontWeight="SemiBold" />
            <TextBlock Text="{Binding SelectedPlugin.Version, TargetNullValue=''}"
                       FontSize="14"
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
          </StackPanel>

          <!-- Description -->
          <StackPanel Spacing="4">
            <TextBlock Text="Description"
                       FontWeight="SemiBold" />
            <TextBlock Text="{Binding SelectedPlugin.Description, TargetNullValue=''}"
                       TextWrapping="Wrap" />
          </StackPanel>

          <!-- Actions -->
          <StackPanel Spacing="8">
            <TextBlock Text="Actions"
                       FontWeight="SemiBold" />
            <StackPanel Orientation="Horizontal" Spacing="8">
              <Button Command="{Binding EnablePluginCommand}"
                      Content="Enable"
                      IsVisible="{Binding SelectedPlugin.IsEnabled, Converter={x:Static BoolConverters.Not}, FallbackValue=False}" />
              <Button Command="{Binding DisablePluginCommand}"
                      Content="Disable"
                      IsVisible="{Binding SelectedPlugin.IsEnabled, FallbackValue=False}" />
              <Button Command="{Binding UninstallPluginCommand}"
                      Content="Uninstall">
                <Button.Styles>
                  <Style Selector="Button">
                    <Setter Property="Background" Value="Transparent" />
                    <Setter Property="BorderBrush" Value="Red" />
                    <Setter Property="Foreground" Value="Red" />
                  </Style>
                </Button.Styles>
              </Button>
            </StackPanel>
          </StackPanel>
        </StackPanel>
      </ScrollViewer>
    </Grid>
  </DockPanel>
</Window>